import{DynamicScript,theme,wallet,price,network,cookies,Modal,api}from"./utils.min.js";new DynamicScript("https://kit.fontawesome.com/c1a16f97ec.js"),theme.load(),document.querySelector("#theme").addEventListener("click",()=>theme.toggle());const obj=document.querySelector("#network-btn");obj.classList.add(network.get().symbol),obj.querySelector(".name").innerHTML=network.get().name,obj.querySelector(".icon").src=`img/${network.get().symbol}.png`,obj.addEventListener("click",(function(){const dropdown=document.createElement("div");dropdown.id="dropdown",dropdown.innerHTML=Object.entries(network.getList()).map(([k,v])=>`<div id="${k}" class="item"><a href="/${k}"><img class="icon" src="img/${k}.png"><span class="name">${v.name}</span></a></div>`).join(""),dropdown.style.top=`${this.offsetTop+this.clientHeight}px`,dropdown.style.left=`${this.offsetLeft+this.clientWidth-130}px`;const fog=document.createElement("div");fog.id="fog",fog.classList.add("invisible"),document.body.appendChild(fog),fog.appendChild(dropdown),fog.addEventListener("click",()=>fog.remove())})),document.querySelectorAll(".token-name").forEach(e=>e.innerHTML=network.get().token),document.querySelectorAll(".chain-symbol").forEach(e=>e.innerHTML=network.get().symbol),document.querySelectorAll(".chain-name").forEach(e=>e.innerHTML=network.get().name),price.token=network.get().token,price.update(),setInterval(()=>price.update(),1e4);const explorer=document.querySelector("footer .resources #explorer");explorer.href=network.get().explorer.href,explorer.querySelector("img").src=network.get().explorer.icon,explorer.querySelector(".name").innerHTML=network.get().explorer.name,wallet.loadImg(document.querySelector("#donate"),network.get()),document.querySelectorAll(".donate-link").forEach(e=>wallet.bindModal(e,network.get()));const session={get:function(){return cookies.get("session")},set:function(id){cookies.set("session",id,{expires:{hours:1}})},delete:function(){cookies.delete("session")},validate:async function(password){let body={password:password};if(!password&&(body={currentSession:this.get()},!this.get()))return!1;const data=await api.request("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)});return data.error?(this.delete(),data):(this.set(data.sessionId),data)},login:async function(){const buttonPress=async modal=>{const value=modal.domObject.querySelector("input").value.trim();if(value.length>0){const button=modal.domObject.querySelector("button");button.innerHTML='<i class="fas fa-spin fa-cog"></i>',button.setAttribute("disabled",!0),modal.domObject.querySelector("input").setAttribute("disabled",!0);const data=await this.validate(value);if(data.error)return void new Modal(`<h2>${data.error}</h2>\n                        <p>${data.message}</p>\n                        <div id="button-container"><button id="close">OK</button></div>`,{fog:{dark:!0}}).addEvent({tag:"button",event:"click",callback:()=>this.login()});this.set(data.sessionId),modal.close(),this.loaded=!0}},modal=new Modal('<h2>Admin Login</h2>\n            <div class="input-container">\n                <input class="input-text" type="password">\n                <button class="input-button"><i class="fas fa-sign-in-alt"></i></button>\n            </div>\n        ',{id:"admin-login",fog:{close:!1,dark:!0}});modal.addEvent({tag:"button",event:"click",callback:()=>buttonPress(modal)}),modal.addEvent({class:"input-text",event:"keyup",callback:e=>{"Enter"==e.key&&buttonPress(modal)}})},check:async function(){const data=await this.validate();return!data||data.error?(this.delete(),this.login(),await new Promise(resolve=>{const monitor=()=>{this.loaded?resolve(!0):setTimeout(()=>monitor(),100)};monitor()})):(this.set(data.sessionId),!0)}};session.check().then(async()=>{await chart.init(),document.querySelector("#timeframe-switcher #tf-h").click(),theme.onChange=()=>{chart.setTheme(cookies.get("theme")||"dark")},theme.set(cookies.get("theme")||"dark")});const chart={package:import("https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"),ready:!1,timeframe:60,page:1,candles:1e3,lastCandle:((new Date).getTime()/1e3).toFixed(0),allRead:!1,network:network.get().symbol,init:async function(){await this.package,document.querySelector("#chart").innerHTML="",this.obj=LightweightCharts.createChart(document.querySelector("#chart"),{width:Math.min(document.querySelector("#frame").offsetWidth-20,600),height:300,crosshair:{mode:LightweightCharts.CrosshairMode.Normal},timeScale:{timeVisible:!0,secondsVisible:!1}}),window.addEventListener("resize",()=>{this.obj.resize(Math.min(document.querySelector("#frame").offsetWidth-20,600),300)}),this.series,document.querySelectorAll("#timeframe-switcher button").forEach(b=>b.addEventListener("click",async()=>{document.querySelectorAll("#timeframe-switcher button").forEach(e=>e.classList.remove("active"));const text=b.innerHTML;b.innerHTML='<i class="fas fa-spin fa-cog"></i>';const history=await this.getHistory(b.id.split("tf-")[1]);b.classList.add("active"),b.innerHTML=text,this.update(history)})),this.timeScale=this.obj.timeScale(),this.timeScale.subscribeVisibleLogicalRangeChange(async()=>{const logicalRange=this.timeScale.getVisibleLogicalRange();if(null!==logicalRange&&logicalRange.from<0&&this.history.length>=this.candles&&!this.scrolling&&!this.allRead){this.scrolling=!0;const oldHistory=this.history,newHistory=await this.getHistory(this.timeframe,this.page+1);this.history=[...oldHistory,...newHistory],this.update(this.history),this.page++,this.scrolling=!1,0==newHistory.length&&(this.allRead=!0)}}),this.ready=!0},update:function(data){if(data.length){const speedData=data.map(e=>({time:parseInt(new Date(e.timestamp).getTime()/1e3),value:e.requests})).reverse();this.series||(this.series=this.obj.addLineSeries()),this.series.setData(speedData)}},setTheme:function(name){let background="#232323",text="#e3dcd0",lines="#3c3c3c";"light"==name&&(background="#eeeeee",text="#511814",lines="#c9c9c9"),this.isReady().then(()=>{this.obj.applyOptions({layout:{backgroundColor:background,textColor:text},grid:{vertLines:{color:lines},horzLines:{color:lines}},rightPriceScale:{borderColor:lines},timeScale:{borderColor:lines}})})},getHistory:async function(timeframe=60,page=1,candles=this.candles){return this.timeframe=timeframe,this.history=await api.request(`/admin/requests?timeframe=${timeframe}&currentSession=${session.get()}`),this.history.error?(console.log(this.history),401==this.history.error.status?this.getHistory(timeframe,page,candles):[]):this.history.results},isReady:async function(){return this.ready||new Promise(resolve=>setTimeout(()=>resolve(this.isReady()),10))}};document.querySelectorAll("#side-menu .item").forEach((e,i)=>e.addEventListener("click",()=>{const content=document.querySelectorAll("#content .menu-content");content.forEach(e=>e.classList.remove("active")),content[i].classList.add("active"),e.parentNode.querySelectorAll(".item").forEach(e=>e.classList.remove("active")),e.classList.add("active")})),document.querySelector("#side-menu #requests").click(),document.querySelector("#side-menu #wallets").addEventListener("click",async()=>{document.querySelector("#content #wallet-table").innerHTML=[...Array(5)].map(w=>'<div class="row placeholder"></div>').join("");const data=await api.request(`/admin/wallets?currentSession=${session.get()}`);if(data.error)return void console.log(data);let wallets=Object.keys(data.balances).map(wallet=>{const value=Object.fromEntries(Object.entries(data.balances[wallet]).filter(([k,v])=>"private"!=k).map(([k,v])=>isNaN(parseFloat(v))?[k,v]:[k,1e-18*parseFloat(v)*parseFloat(data.tokenPrices[k])])),pvt=data.balances[wallet].private;delete data.balances[wallet].private;const total=Object.values(value).reduce((p,c)=>p+c,0);return{wallet:wallet,private:pvt,balance:data.balances[wallet],value:value,total:total}});wallets=wallets.sort((a,b)=>b.total-a.total);const body=wallets.map(w=>`<div class="row">\n        <div class="title">\n            <div class="cell">\n                <span class="info">${w.wallet.slice(0,5)}...${w.wallet.slice(-4)}</span>\n                <span class="text">Wallet</span>\n            </div>\n            <div class="cell">\n                <span class="info">$${w.total.toFixed(4)}</span>\n                <span class="text">Balance</span>\n            </div>\n        </div>\n        <div class="details">\n            ${Object.entries(w.balance).map(([k,v])=>`<div class="row"><div class="cell">${(1e-18*parseFloat(v)).toFixed(6)} <span class="token">${network.getList()[k].token}</span></div><div class="cell">$${w.value[k].toFixed(4)}</div></div>`).join("")}\n            <div class="private-container"><span class="private">${w.private.slice(0,10)}...${w.private.slice(-10)}</span><span class="text">Private Key</span></div>\n        </div>\n    </div>`).join("");document.querySelector("#content #wallet-table").innerHTML=body,document.querySelectorAll("#content #wallet-table .row").forEach(r=>r.addEventListener("click",()=>{r.querySelector(".details").classList.toggle("open")})),document.querySelectorAll("#content #wallet-table .private").forEach((e,i)=>e.addEventListener("click",()=>{navigator.clipboard.writeText(wallets[i].private)}))});
//# sourceMappingURL=admin.min.js.map